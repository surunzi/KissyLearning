/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:41
*/
KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(h,g,n,m){h=g("combobox/control");n=g("combobox/local-data-source");g=g("combobox/remote-data-source");h.LocalDataSource=n;h.RemoteDataSource=g;m.exports=h});
KISSY.add("combobox/control","util,logger-manager,node,component/control,./combobox-xtpl,menu".split(","),function(h,g,n,m){function f(d){for(var a=0;a<d.length;a++)if(!d[a].get("disabled"))return d[a];return null}function b(){t(this)}function u(){var d=this;setTimeout(function(){o(d)},0)}function l(){this.focus();o(this)}function j(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function k(d){var q;q=this.get("menu");if(!d||q===d.target){var d=this.get("input"),i=q.get("el");q=q.get("contentEl");
d.attr("aria-owns",i.attr("id"));i.on("focusout",b,this);i.on("focusin",u,this);q.on("mouseover",l,this);q.on("mousedown",j,this);if(this.get("matchElWidth"))i.getWindow().on("resize",a,this)}}function a(){var d=this.get("menu");if(d.get("visible")){var a=this.get("el"),b=d.get("el"),b=(parseInt(b.css("borderLeftWidth"),10)||0)+(parseInt(b.css("borderRightWidth"),10)||0);d.set("width",a[0].offsetWidth-b)}}function c(d){d=d.target;if(d.isMenuItem){d=d.get("textContent");this.setCurrentValue(d);this._savedValue=
d;this.set("collapsed",true)}}function s(d,a){var b=d.$el,e=d.getBaseCssClasses("invalid"),c=d.get("invalidEl");if(a){b.addClass(e);c.attr("title",a);c.show()}else{b.removeClass(e);c.hide()}}function t(d){if(!d._focusoutDismissTimer)d._focusoutDismissTimer=setTimeout(function(){d._focusoutDismissTimer&&d.set("collapsed",true)},50)}function o(d){var a=d._focusoutDismissTimer;if(a){clearTimeout(a);d._focusoutDismissTimer=null}}function v(d){this.setCurrentValue(d.target.value,{data:{causedByInputEvent:1}})}
function w(d){var a=[],b,e,a=this.get("menu"),d=this.normalizeData(d);a.removeChildren(true);if(d&&d.length){r.now();a.addChildren(d);a=a.get("children");d=this.getCurrentValue();if(this.get("highlightMatchItem"))for(e=0;e<a.length;e++)if(a[e].get("textContent")===d){a[e].set("highlighted",true);b=true;break}if(!b&&this.get("autoHighlightFirst"))for(e=0;e<a.length;e++)if(!a[e].get("disabled")){a[e].set("highlighted",true);break}this.set("collapsed",false);this.fire("afterRenderData")}else this.set("collapsed",
true)}var r=g("util");g("logger-manager");var h=g("node"),n=g("component/control"),x=g("./combobox-xtpl");g("menu");var p=h.Event.KeyCode,g=n.extend({initializer:function(){this.publish("afterRenderData",{bubbles:false})},_savedValue:null,bindUI:function(){this.get("input").on("input",v,this);this.on("click",c,this);var a=this.get("menu");if(a.get("rendered"))k.call(this);else a.on("afterRenderUI",k,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",a,this)},
normalizeData:function(a){var b,i,e;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getCurrentValue(),a):[];for(e=0;e<a.length;e++){i=a[e];b[e]=r.mix({content:i,textContent:i,value:i},b[e])}}return b},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var i=this.get("clearEl"),e;if(b.causedByInputEvent){e=this.getCurrentValue();if(e===void 0){this.set("collapsed",
true);return}this._savedValue=e;this.sendRequest(e)}else this.get("input").val(a);a&&i?i.show():!a&&i&&i.hide()},handleFocusInternal:function(){var a;o(this);this.get("invalidEl")&&s(this,false);(a=this.get("placeholderEl"))&&a.hide()},handleBlurInternal:function(a){var b=this,i=b.get("placeholderEl");b.callSuper(a);t(b);b.get("invalidEl")&&b.validate(function(a,d){a?!b.get("focused")&&d===b.get("value")&&s(b,a):s(b,false)});i&&!b.get("value")&&i.show()},handleMouseDownInternal:function(a){var b,
i,e;this.callSuper(a);b=a.target;e=this.get("trigger");i=this.get("clearEl");if(e&&(e[0]===b||e.contains(b))){if(this.get("collapsed")){this.focus();this.sendRequest("")}else this.set("collapsed",true);a.preventDefault()}else if(i&&(i[0]===b||i.contains(b))){this.get("input").val("");this.setCurrentValue("",{data:{causedByInputEvent:1}});i.hide()}},handleKeyDownInternal:function(a){var b,i=a.keyCode,e,c,o=this.get("menu");this.get("input");b=this.get("updateInputOnDownUp");if(o.get("visible")){e=
o.get("highlightedItem");if(b&&e){c=o.get("children");if(i===p.DOWN&&e===f(c.concat().reverse())||i===p.UP&&e===f(c)){this.setCurrentValue(this._savedValue);e.set("highlighted",false);return true}}c=o.handleKeyDownInternal(a);e=o.get("highlightedItem");if(i===p.ESC){this.set("collapsed",true);b&&this.setCurrentValue(this._savedValue);return true}b&&r.inArray(i,[p.DOWN,p.UP])&&this.setCurrentValue(e.get("textContent"));if(i===p.TAB&&e){e.handleClickInternal(a);if(this.get("multiple"))return true}return c}if(i===
p.DOWN||i===p.UP){a=this.getCurrentValue();if(a!==void 0){this.sendRequest(a);return true}}},validate:function(a){var b=this.get("validator"),c=this.getCurrentValue();b?b(c,function(b){a(b,c)}):a(false,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,w,this)},getKeyEventTarget:function(){return this.get("input")},_onSetCollapsed:function(a){var b=this.$el,c=this.get("menu");if(a)c.hide();else{o(this);if(!c.get("visible")){if(this.get("matchElWidth")){c.render();var e=c.get("el"),e=(parseInt(e.css("borderLeftWidth"),
10)||0)+(parseInt(e.css("borderRightWidth"),10)||0);c.set("width",b[0].offsetWidth-e)}c.show()}}this.get("input").attr("aria-expanded",!a)},_onSetDisabled:function(a,b){this.callSuper(a,b);this.get("input").attr("disabled",a)}},{ATTRS:{contentTpl:{value:x},input:{selector:function(){return"."+this.getBaseCssClass("input")}},value:{value:"",sync:0,render:1,parse:function(){return this.get("input").val()}},trigger:{selector:function(){return"."+this.getBaseCssClass("trigger")}},placeholder:{render:1,
sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},clearEl:{selector:function(){return"."+this.getBaseCssClass("clear")}},validator:{},invalidEl:{selector:function(){return"."+this.getBaseCssClass("invalid-el")}},allowTextSelection:{value:true},hasTrigger:{value:true,sync:0,render:1},menu:{getter:function(a){a=a||{};if(!a.isControl){a.xclass=a.xclass||"popupmenu";a=this.createComponent(a);
this.setInternal("menu",a)}return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};r.mix(a.get("align"),b,false)}}},collapsed:{render:1,sync:0,value:true},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:true},format:{},updateInputOnDownUp:{value:true},autoHighlightFirst:{},highlightMatchItem:{value:true}},xclass:"combobox"});m.exports=g});
KISSY.add("combobox/combobox-xtpl",[],function(h,g,n,m){h=function(f,b,g){var l=this,j=l.root.utils.callFn,k=l.root.nativeCommands["if"];b.write('<div class="',0);var a={escape:1},c=[];c.push("invalid-el");a.params=c;if((a=j(l,f,a,b,["getBaseCssClasses"],0,1))&&a.isBuffer)b=a,a=g;b.write(a,!0);b.write('">\r\n    <div class="',0);a={escape:1};c=[];c.push("invalid-inner");a.params=c;if((a=j(l,f,a,b,["getBaseCssClasses"],0,2))&&a.isBuffer)b=a,a=g;b.write(a,!0);b.write('"></div>\r\n</div>\r\n\r\n',0);
var a={escape:1},c=[],h=f.resolve(["hasTrigger"],0);c.push(h);a.params=c;a.fn=function(a,b){b.write('\r\n<div class="',0);var c={escape:1},f=[];f.push("trigger");c.params=f;if((c=j(l,a,c,b,["getBaseCssClasses"],0,6))&&c.isBuffer)b=c,c=g;b.write(c,!0);b.write('">\r\n    <div class="',0);c={escape:1};f=[];f.push("trigger-inner");c.params=f;if((c=j(l,a,c,b,["getBaseCssClasses"],0,7))&&c.isBuffer)b=c,c=g;b.write(c,!0);b.write('">&#x25BC;</div>\r\n</div>\r\n',0);return b};b=k.call(l,f,a,b,5);b.write('\r\n\r\n<div class="',
0);a={escape:1};c=[];c.push("input-wrap");a.params=c;if((a=j(l,f,a,b,["getBaseCssClasses"],0,11))&&a.isBuffer)b=a,a=g;b.write(a,!0);b.write('">\r\n\r\n    <input id="ks-combobox-input-',0);a=f.resolve(["id"],0);b.write(a,!0);b.write('"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ',0);a={escape:1};c=[];h=f.resolve(["disabled"],0);c.push(h);a.params=c;a.fn=
function(a,b){b.write("\r\n    disabled\r\n    ",0);return b};b=k.call(l,f,a,b,20);b.write('\r\n\r\n    autocomplete="off"\r\n    class="',0);a={escape:1};c=[];c.push("input");a.params=c;if((a=j(l,f,a,b,["getBaseCssClasses"],0,25))&&a.isBuffer)b=a,a=g;b.write(a,!0);b.write('"\r\n\r\n    value="',0);a=f.resolve(["value"],0);b.write(a,!0);b.write('"\r\n    />\r\n\r\n\r\n    <label for="ks-combobox-input-',0);a=f.resolve(["id"],0);b.write(a,!0);b.write("\"\r\n            style='display:",0);a={escape:1};
c=[];h=f.resolve(["value"],0);c.push(h);a.params=c;a.fn=function(a,b){b.write("none",0);return b};a.inverse=function(a,b){b.write("block",0);return b};b=k.call(l,f,a,b,32);b.write(";'\r\n    class=\"",0);a={escape:1};c=[];c.push("placeholder");a.params=c;if((a=j(l,f,a,b,["getBaseCssClasses"],0,33))&&a.isBuffer)b=a,a=g;b.write(a,!0);b.write('">\r\n    ',0);a=f.resolve(["placeholder"],0);b.write(a,!0);b.write('\r\n    </label>\r\n\r\n    <div class="',0);a={escape:1};c=[];c.push("clear");a.params=c;
if((a=j(l,f,a,b,["getBaseCssClasses"],0,37))&&a.isBuffer)b=a,a=g;b.write(a,!0);b.write('"\r\n         unselectable="on"\r\n         ',0);a={escape:1};c=[];h=f.resolve(["value"],0);c.push(!h);a.params=c;a.fn=function(a,b){b.write('\r\n         style="display:none"\r\n         ',0);return b};b=k.call(l,f,a,b,39);b.write('\r\n         onmousedown="return false;"><div\r\n            class="',0);k={escape:1};a=[];a.push("clear-inner");k.params=a;if((f=j(l,f,k,b,["getBaseCssClasses"],0,43))&&f.isBuffer)b=
f,f=g;b.write(f,!0);b.write('">clear</div></div>\r\n</div>\r\n',0);return b};h.TPL_NAME=m.name;h.version="5.0.0";m.exports=h});KISSY.add("combobox/local-data-source",["attribute","util"],function(h,g,n,m){var h=g("attribute"),f=g("util");m.exports=h.extend({fetchData:function(b,f,g){var j=this.get("parse"),h=this.get("data"),h=j(b,h);f.call(g,h)}},{ATTRS:{data:{value:[]},parse:{value:function(b,g){var h=[],j=0;if(!b)return g;f.each(g,function(f){-1!==f.indexOf(b)&&h.push(f);j++});return h}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(h,g,n,m){var f=g("io"),h=g("attribute");m.exports=h.extend({fetchData:function(b,g,h){var j=this,k,a=j.get("paramName"),c=j.get("parse"),m=j.get("cache"),n=j.get("allowEmpty");j.caches=j.caches||{};j.io&&(j.io.abort(),j.io=null);if(!b&&!0!==n)return g.call(h,[]);if(m&&(k=j.caches[b]))return g.call(h,k);k=j.get("xhrCfg");k.data=k.data||{};k.data[a]=b;k.success=function(a){c&&(a=c(b,a));j.setInternal("data",a);m&&(j.caches[b]=a);g.call(h,
a)};j.io=f(k)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{valueFn:function(){return{}}}}})});

/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:40
*/
KISSY.add("anim/transition",["util","logger-manager","dom","./base","feature"],function(l,i,s,n){function o(d){var c="";g.each(d,function(a,b){c&&(c+=",");c+=b+" "+a.duration+"s "+a.easing+" "+a.delay+"s"});return c}function p(d){return d.replace(/[A-Z]/g,function(c){return"-"+c.toLowerCase()})}function h(d,c,a,b,f){if(!(this instanceof h))return new h(d,c,a,b,f);h.superclass.constructor.apply(this,arguments)}var g=i("util"),q=i("logger-manager"),j=i("dom"),l=i("./base"),m=i("feature").getCssVendorInfo,
k=m("transition").propertyName,r={ease:1,linear:1,"ease-in":1,"ease-out":1,"ease-in-out":1};g.extend(h,l,{prepareFx:function(){var d=this._propsData,c={},a,b;for(b in d)a=d[b],"string"===typeof a.easing?!g.startsWith(a.easing,"cubic-bezier")&&!r[a.easing]&&(a.easing="linear"):a.easing="linear",(a=m(b))?c[p(a.propertyName)]=d[b]:q.log("unsupported css property for transition anim: "+b,"error");this._propsData=c},doStart:function(){var d=this,c=d.node,a=c.style,b=d._propsData,f=a[k],e=0,h={};g.each(b,
function(b,a){var d=b.value;j.css(c,a,j.css(c,a));h[a]=d;e=Math.max(b.duration+b.delay,e)});-1!==f.indexOf("none")?f="":f&&(f+=",");a[k]=f+o(b);setTimeout(function(){j.css(c,h)},0);d._transitionEndTimer=setTimeout(function(){d.stop(!0)},1E3*e)},beforeResume:function(){var d=this._propsData,c=g.merge(d),a=this._runTime/1E3;g.each(c,function(b,c){var e=a;b.delay>=e?b.delay-=e:(e-=b.delay,b.delay=0,b.duration>=e?b.duration-=e:delete d[c])})},doStop:function(d){var c=this.node,a=c.style,b=this._propsData,
f=[],e={};this._transitionEndTimer&&(clearTimeout(this._transitionEndTimer),this._transitionEndTimer=null);g.each(b,function(b,a){d||(e[a]=j.css(c,a));f.push(a)});b=g.trim(a[k].replace(RegExp("(^|,)\\s*(?:"+f.join("|")+")\\s+[^,]+","gi"),"$1")).replace(/^,|,,|,$/g,"")||"none";a[k]=b;j.css(c,e)}});g.mix(h,l.Statics);n.exports=h});

/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:51
*/
KISSY.add("event/gesture/util",["./util/add-event","./util/touch","./util/single-touch","./util/double-touch"],function(h,c,t,l){h=c("./util/add-event");l.exports={addEvent:h,Touch:c("./util/touch"),SingleTouch:c("./util/single-touch"),DoubleTouch:c("./util/double-touch")}});
KISSY.add("event/gesture/util/add-event",["util","dom","ua","event/dom/base","feature"],function(h,c,t,l){function i(a){return n.startsWith(a,"touch")}function j(a){return n.startsWith(a,"mouse")}function g(a){return n.startsWith(a,"MSPointer")||n.startsWith(a,"pointer")}function f(a){this.doc=a;this.eventHandles=[];this.init();this.touches=[];this.inTouch=0}function x(a){v(this,a)}function y(a){w(this,a)}function z(a){v(this,a);r[a].setup.apply(this,arguments)}function A(a){w(this,a);r[a].tearDown.apply(this,
arguments)}function v(a,b){var d=s.getDocument(a),e=s.data(d,u);e||s.data(d,u,e=new f(d));b&&e.addEventHandle(b)}function w(a,b){var d=s.getDocument(a),e=s.data(d,u);e&&(b&&e.removeEventHandle(b),e.eventHandles.length||(e.destroy(),s.removeData(d,u)))}var n=c("util"),s=c("dom"),r={},h=c("ua"),m=c("event/dom/base"),B=m.Special,u=n.guid("touch-handle"),c=c("feature"),o,k,p;c.isTouchEventSupported()?h.ios?(p="touchend touchcancel",o="touchstart",k="touchmove"):(p="touchend touchcancel mouseup",o="touchstart mousedown",
k="touchmove mousemove"):c.isPointerSupported()?(o="pointerdown",k="pointermove",p="pointerup pointercancel"):c.isMsPointerSupported()?(o="MSPointerDown",k="MSPointerMove",p="MSPointerUp MSPointerCancel"):(o="mousedown",k="mousemove",p="mouseup");f.prototype={constructor:f,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;m.on(a,o,this.onTouchStart,this);if(!g(k))m.on(a,k,this.onTouchMove,this);m.on(a,p,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},
removeTouch:function(a){for(var b=0,d=a.pointerId,e=this.touches,q=e.length;b<q;b++){a=e[b];if(a.pointerId===d){e.splice(b,1);break}}},updateTouch:function(a){for(var b=0,d,e=a.pointerId,q=this.touches,c=q.length;b<c;b++){d=q[b];d.pointerId===e&&(q[b]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=
this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var d={x:a.clientX,y:a.clientY};b.push(d);setTimeout(function(){var a=b.indexOf(d);a>-1&&b.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,d=a.clientX,a=a.clientY,e=0,q=b.length,c;e<q&&(c=b[e]);e++){var j=Math.abs(d-c.x),g=Math.abs(a-c.y);if(j<=25&&g<=25)return true}return 0},normalize:function(a){var b=a.type,d,e;if(d=i(b)){e=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;a.gestureType=
"touch"}else{if(g(b))a.gestureType=a.originalEvent.pointerType;else if(j(b))a.gestureType="mouse";e=this.touches}if(e&&e.length===1){a.which=1;a.pageX=e[0].pageX;a.pageY=e[0].pageY}if(d)return a;b=!b.match(/(up|cancel)$/i);a.touches=b?e:[];a.targetTouches=b?e:[];a.changedTouches=e;return a},onTouchStart:function(a){var b,d=a.type,e=this.eventHandles;if(i(d)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(j(d)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a]}else if(g(d)){this.addTouch(a.originalEvent);
if(this.touches.length===1)m.on(this.doc,k,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(var d=0,c=e.length;d<c;d++){b=e[d];b=e[b].handle;b.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(j(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=[a]}else if(g(b))this.updateTouch(a.originalEvent);else if(!i(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=
this,d=a.type;if(!j(d)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(i(d)){b.dupMouse(a);n.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(j(d))b.touches=[];else if(g(d)){b.removeTouch(a.originalEvent);b.touches.length||m.detach(b.doc,k,b.onTouchMove,b)}}},callEventHandle:function(a,b){var d=this.eventHandles,e=d.concat(),c,b=this.normalize(b),j=b.gestureType;if(b.changedTouches.length){for(var g=0,f=e.length;g<f;g++){c=e[g];if(d[c]){c=d[c].handle;
if(!(c.requiredGestureType&&j!==c.requiredGestureType)&&!c.processed){c.processed=1;if(c.isActive&&c[a]&&c[a](b)===false)c.isActive=0}}}g=0;for(f=e.length;g<f;g++){c=d[g];if(d[c]){c=d[c].handle;c.processed=0}}}},addEventHandle:function(a){var b=this.eventHandles,c=r[a].handle;if(b[a])b[a].count++;else{b.push(a);this.sortEventHandles();b[a]={count:1,handle:c}}},sortEventHandles:function(){this.eventHandles.sort(function(a,b){return r[a].order-r[b].order})},removeEventHandle:function(a){var b=this.eventHandles;
if(b[a]){b[a].count--;if(!b[a].count){b.splice(n.indexOf(a,b),1);delete b[a]}}},destroy:function(){var a=this.doc;m.detach(a,o,this.onTouchStart,this);m.detach(a,k,this.onTouchMove,this);m.detach(a,p,this.onTouchEnd,this)}};l.exports=function(a,b){typeof a==="string"&&(a=[a]);n.each(a,function(a){var c={};c.setup=b.setup?z:x;c.tearDown=b.tearDown?A:y;c.add=b.add;c.remove=b.remove;b.order=b.order||100;r[a]=b;B[a]=c})}});
KISSY.add("event/gesture/util/touch",[],function(h,c,t,l){function i(){}h=function(){};i.prototype={constructor:i,requiredTouchCount:0,onTouchStart:function(c){var g=this.requiredTouchCount,f=c.touches.length;if(f===g)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=c.touches,this.startTime=c.timeStamp,this.start(c);if(f>g)this.onTouchEnd(c,!0)},onTouchMove:function(c){if(this.isTracking)return this.lastTouches=c.touches,this.move(c)},onTouchEnd:function(c,g){this.isTracking&&
(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.end(c,g)))},start:h,move:h,end:h};l.exports=i});KISSY.add("event/gesture/util/single-touch",["./touch","util"],function(h,c,t,l){function i(){}h=c("./touch");c("util").extend(i,h,{requiredTouchCount:1,start:function(){i.superclass.start.apply(this,arguments);var c=this.lastTouches;this.lastXY={pageX:c[0].pageX,pageY:c[0].pageY}}});l.exports=i});
KISSY.add("event/gesture/util/double-touch",["dom","./touch","util"],function(h,c,t,l){function i(){}var j=c("dom"),h=c("./touch");c("util").extend(i,h,{requiredTouchCount:2,getCommonTarget:function(c){var f=c.touches,c=f[0].target,f=f[1].target;if(c===f||j.contains(c,f))return c;for(;f;){if(j.contains(f,c))return f;f=f.parentNode}}});l.exports=i});

/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:54
*/
KISSY.add("toolbar",["component/container","component/extension/delegate-children","util","node"],function(j,h,k,l){function g(a,b,c){var c=c.get("children"),d=0,e=c.length;if(void 0===a&&(a=1===b?0:e-1,!c[a].get("disabled")))return c[a];do d++,a=(a+e+b)%e;while(d<e&&c[a].get("disabled"));return d!==e?c[a]:null}function m(a){a.newVal?this.set("expandedItem",null):this.set("expandedItem",a.target)}function n(a){var b=a.target;if(this!==b&&(b.isMenuItem||b.isButton))a.newVal?(a=this.get("children"),
this.get("expandedItem")&&i.inArray(b,a)&&this.set("expandedItem",b.isMenuButton?b:null),this.set("highlightedItem",b)):a.byPassSetToolbarHighlightedItem||this.set("highlightedItem",null)}var j=h("component/container"),k=h("component/extension/delegate-children"),i=h("util"),f=h("node").Event.KeyCode;l.exports=j.extend([k],{beforeCreateDom:function(a){a.elAttrs.role="toolbar"},bindUI:function(){this.on("afterCollapsedChange",m,this);this.on("afterHighlightedChange",n,this)},handleBlurInternal:function(a){var b;
this.callSuper(a);this.set("expandedItem",null);(b=this.get("highlightedItem"))&&b.set("highlighted",!1)},getNextItemByKeyDown:function(a,b){var c=this.get("children"),c=b&&i.indexOf(b,c);if(b&&b.handleKeyDownInternal(a))return!0;if(a.shiftKey||a.ctrlKey||a.metaKey||a.altKey)return!1;switch(a.keyCode){case f.ESC:return this.getKeyEventTarget().fire("blur"),!0;case f.HOME:b=g(void 0,1,this);break;case f.END:b=g(void 0,-1,this);break;case f.UP:b=g(c,-1,this);break;case f.LEFT:b=g(c,-1,this);break;case f.DOWN:b=
g(c,1,this);break;case f.RIGHT:b=g(c,1,this);break;default:return!1}return b},handleKeyDownInternal:function(a){var b;a:{b=this.get("children");var c,d;for(c=0;c<b.length;c++)if(d=b[c],d.get("highlighted")||d.isMenuButton&&!d.get("collapsed")){b=d;break a}b=null}a=this.getNextItemByKeyDown(a,b);if("boolean"===typeof a)return a;a&&a.set("highlighted",!0);return!0},_onSetHighlightedItem:function(a,b){var c,d;c=b&&b.prevVal;d=this.get("children");var e=this.el;c&&i.inArray(c,d)&&c.set("highlighted",
!1,{data:{byPassSetToolbarHighlightedItem:1}});a?(e.ownerDocument.activeElement!==e&&this.focus(),d=a.el,c=d.id,c||(d.id=c=i.guid("ks-toolbar-item")),e.setAttribute("aria-activedescendant",c)):e.setAttribute("aria-activedescendant","")},_onSetExpandedItem:function(a,b){b&&b.prevVal&&b.prevVal.set("collapsed",!0);a&&a.set("collapsed",!1)}},{xclass:"toolbar",ATTRS:{highlightedItem:{},expandedItem:{},defaultChildCfg:{valueFn:function(){return{xclass:"button",handleGestureEvents:!1,focusable:!1}}}}})});
